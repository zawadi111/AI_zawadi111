# visualization.py 사용 가이드

## 📊 개요

`visualization.py`는 FHMM 모델의 디코딩 결과를 시각화하는 파일입니다.

**출력:**
- 각 가전별 그래프 (5개)
- 실제 유효전력값 (빨간 점선)
- 모델 예측 전력값 (파란 실선)
- 성능 지표 (MAE, RMSE)

---

## 🚀 기본 사용법

### 1️⃣ 기본 설정 (앞 10,080개 시간)

```bash
python visualization.py
```

**자동 실행 항목:**
- 모델 로드 (`fhmm_model.pkl`)
- 디코딩 실행
- 그래프 생성 및 저장
- 성능 지표 출력

---

## ⚙️ 시간 범위 조정

파일을 열어서 설정값을 수정하세요:

```python
# visualization.py 상단의 설정값

# 시간 범위 설정 (기본값: 앞 10,080개)
START_IDX = 0      # 시작 인덱스
END_IDX = 10080    # 종료 인덱스
```

### 예제 1: 처음 7,200개 (5일)

```python
START_IDX = 0
END_IDX = 7200
```

```bash
python visualization.py
```

### 예제 2: 특정 구간 (870~950)

```python
START_IDX = 870
END_IDX = 950
```

### 예제 3: 전체 데이터

```python
START_IDX = 0
END_IDX = 262080  # 또는 len(observations)
```

---

## 📈 그래프 상한값 조정

각 가전별 그래프의 y축 상한값을 수정할 수 있습니다:

```python
# visualization.py의 Y_LIMITS 설정

Y_LIMITS = {
    'CWE': 1000,   # Clothes Washer
    'DWE': 1000,   # Dishwasher
    'CDE': 6000,   # Clothes Dryer
    'WOE': 4000,   # Wall Oven
    'HPE': 3000    # Heat Pump
}
```

### 예제: Heat Pump 상한값 증가

```python
Y_LIMITS = {
    'CWE': 1000,
    'DWE': 1000,
    'CDE': 6000,
    'WOE': 4000,
    'HPE': 5000   # 3000 → 5000
}
```

---

## 📋 파일 구조

```
visualization.py
├── 모델 로드
├── 데이터 로드
├── 디코딩 실행
├── 예측 전력값 계산
├── 그래프 생성
├── 그래프 저장
└── 요약 통계 출력
```

---

## 📊 출력 내용

### 1️⃣ 그래프 파일

**저장 위치:** `./visualization_{START_IDX}_{END_IDX}.png`

**포함 내용:**
- CDE (Clothes Dryer)
- CWE (Clothes Washer)
- DWE (Dishwasher)
- WOE (Wall Oven)
- HPE (Heat Pump)

각 그래프에는:
- 빨간 점선: 실제 유효전력값
- 파란 실선: 모델 예측 전력값

### 2️⃣ 콘솔 출력

```
======================================================================
디코딩 결과 시각화
======================================================================

[1] 모델 로드 중...
✓ 모델 로드: ./fhmm_model.pkl

[2] 실제 데이터 로드 중...
[3] 개별 가전 데이터 로드 중...
[4] 디코딩 실행 중...
✓ 디코딩 성공! (10080개 시점 추론)

[5] 예측 전력값 계산 중...
[6] 그래프 생성 중...

======================================================================
시간 범위: 0~10080 (10080개 샘플)
파일명: visualization_0_10080.png
======================================================================

✓ 그래프 저장: ./visualization_0_10080.png

======================================================================
요약 통계
======================================================================

CDE:
  실제값 범위: 0.03W ~ 4686.52W
  예측값 범위: 0.03W ~ 4686.52W
  MAE (평균절대오차): 123.45W
  RMSE (루트평균제곱오차): 456.78W

CWE:
  실제값 범위: 0.01W ~ 484.54W
  예측값 범위: 0.01W ~ 484.54W
  MAE (평균절대오차): 23.45W
  RMSE (루트평균제곱오차): 56.78W

...
```

---

## 📊 성능 지표 설명

### MAE (Mean Absolute Error)

평균절대오차 - 실제값과 예측값의 평균 차이

```
MAE = (1/n) * Σ|실제값 - 예측값|
```

- 작을수록 좋음
- 단위: W (와트)

### RMSE (Root Mean Square Error)

루트평균제곱오차 - 큰 오차에 더 민감

```
RMSE = √[(1/n) * Σ(실제값 - 예측값)²]
```

- 작을수록 좋음
- 단위: W (와트)

---

## 🔧 커스터마이즈 예제

### 예제 1: 일주일 데이터 (7일 = 10,080분)

```python
START_IDX = 0
END_IDX = 10080
```

### 예제 2: 특정 시간대 (2시간 = 120분)

```python
START_IDX = 500
END_IDX = 620
```

### 예제 3: 한 달 데이터

```python
START_IDX = 0
END_IDX = 43200  # 약 30일
```

### 예제 4: 그래프 해상도 높이기

```python
# visualization.py에서
fig, axes = plt.subplots(5, 1, figsize=(14, 12))
# ↓
fig, axes = plt.subplots(5, 1, figsize=(20, 15))  # 더 큼
```

---

## ⚠️ 주의사항

1. **모델 필수**: `fhmm_model.pkl` 파일이 없으면 실행 불가
   ```bash
   python test.py  # 먼저 실행
   ```

2. **데이터 범위**: `END_IDX`는 전체 데이터 길이(262,080)를 초과할 수 없음

3. **메모리**: 큰 데이터(전체 262,080개)는 시간이 오래 걸릴 수 있음

4. **그래프 상한값**: 너무 작으면 그래프가 찌그러질 수 있음

---

## 📝 실행 흐름

```
START
  ↓
[1] 모델 로드 → fhmm_model.pkl
  ↓
[2] 실제 데이터 로드 → Total_Sumed.csv
  ↓
[3] 개별 가전 데이터 로드 → modified *.csv
  ↓
[4] 디코딩 실행 → 각 시점의 상태 예측
  ↓
[5] 예측 전력값 계산 → 상태의 평균값으로 변환
  ↓
[6] 그래프 생성 → matplotlib
  ↓
[7] 저장 및 출력 → PNG 파일 + 콘솔 통계
  ↓
END
```

---

## 💡 팁

1. **빠른 확인**: 작은 범위로 먼저 테스트
   ```python
   START_IDX = 0
   END_IDX = 1000
   ```

2. **고해상도 저장**: figsize 증가
   ```python
   fig, axes = plt.subplots(5, 1, figsize=(20, 15))
   plt.savefig(save_path, dpi=300, bbox_inches='tight')  # dpi 증가
   ```

3. **여러 구간 비교**: 설정 변경 후 여러 번 실행
   ```python
   # 첫 번째 실행
   END_IDX = 5000
   
   # 두 번째 실행
   END_IDX = 10000
   ```

---

이제 모델의 성능을 시각적으로 확인할 수 있습니다! 📊
